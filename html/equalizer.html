<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
<title>css equalizer &amp; audio</title>
<meta name="Keywords" content="">
<meta name="Description" content="">
<link rel="stylesheet" href="../css/base.css" />
<script src="../js/jquery-3.2.1.min.js"></script>
<!--[if lt ie 9]>
<script src="../js/html5.js"></script>
<script src="../js/respond.js"></script>
<![endif]-->
<style>
.btn_eq {margin:10px auto 0; width:100px; height:50px; display:block; position:relative; background:#ddd;}
.btn_eq:before {content:"stop"; width:100%; height:100%; line-height:50px; text-align:center; position:absolute; left:0; top:0;}
.btn_eq.on:before {content:"play";}
.btn_layer {margin:10px auto 0; width:100px; height:50px; display:block; position:relative; background:#ddd;}
.btn_layer:before {content:"layer"; width:100%; height:100%; line-height:50px; text-align:center; position:absolute; left:0; top:0;}
.btn_close1 {margin:10px auto 0; width:100px; height:50px; display:block; position:relative; background:#ddd;}
.btn_close1:before {content:"close1"; width:100%; height:100%; line-height:50px; text-align:center; position:absolute; left:0; top:0;}
[data-media="audio"] {}
#equalizer {margin:0 auto 0; width:40px; height:30px; position:relative; overflow:hidden; cursor:pointer; }
#equalizer>span {width:3px; height:1px; display:inline-block; bottom:0; position:absolute; background-color:#000;
    animation-duration:500ms;
    animation-play-state:running;
    animation-direction:alternate;
    animation-timing-function:linear;
    animation-iteration-count:infinite;
}

#equalizer>span.stop {
    animation:none;
    animation-name:none;
}

#equalizer>.bar1 {
    left:0;
    animation-name:danceHeight1;
    animation-delay:300ms;
}
#equalizer>.bar2 {
    left:6px;
    animation-name:danceHeight2;
    animation-delay:600ms;
}
#equalizer>.bar3 {
    left:12px;
    animation-name:danceHeight3;
    animation-delay:0ms;
}
#equalizer>.bar4 {
    left:18px;
    animation-name:danceHeight4;
    animation-delay:1500ms;
}
#equalizer>.bar5 {
    left:24px;
    animation-name:danceHeight5;
    animation-delay:1200ms;
}
#equalizer>.bar6 {
    left:30px;
    animation-name:danceHeight6;
    animation-delay:900ms;
}

@keyframes danceHeight1 {
    from {height:1px;}
    to {height:18px;}
}
@keyframes danceHeight2 {
    from {height:1px;}
    to {height:15px;}
}
@keyframes danceHeight3 {
    from {height:1px;}
    to {height:22px;}
}
@keyframes danceHeight4 {
    from {height:1px;}
    to {height:10px;}
}
@keyframes danceHeight5 {
    from {height:1px;}
    to {height:20px;}
}
@keyframes danceHeight6 {
    from {height:1px;}
    to {height:15px;}
}
</style>
</head>
<body>
    <div id="equalizer">
        <span class="bar1"></span>
        <span class="bar2"></span>
        <span class="bar3"></span>
        <span class="bar4"></span>
        <span class="bar5"></span>
        <span class="bar6"></span>
    </div>
    <button type="button" class="btn_eq" data-btn="eq"></button>
    <audio controls="controls" data-media="audio"></audio>
    <button type="button" class="btn_layer"></button>
    <button type="button" class="btn_close1"></button>
    <script>
        var Equalizer = (function(){

            var $parent, $children, $audio = $("[data-media='audio']"), $btn;
            var state = {
                startSet:true
            }

            function Person(opts){
                this.init(opts);
            }

            Person.prototype = {
                init : function(opts){
                    $parent = $(opts.parent), $children = $(opts.children), $btn = $(opts.btn), state.url = opts.url, state.volume = opts.volume;

                    this.eqAction(opts.setStr);
                    this.controls();
                },
                controls : function(){
                    var context = this;
                    $btn.on("click", function(){
                        var chk = (state.playChk1==true) ? false : true ;
                        context.eqAction(chk);
                    });
                },
                eqAction : function(str){
                    if(str==true){
                        $parent.find($children).removeClass("stop");    // equalizer 애니메이션 추가
                        this.setAudio();
                        $audio[0].play();   // audio 플레이
                        $btn.addClass("on");
                        state.playChk1 = str;
                    }else{
                        $parent.find($children).addClass("stop");    // equalizer 애니메이션 삭제
                        this.setAudio();
                        $audio[0].pause();   // audio 일시정지
                        $btn.removeClass("on");
                        state.playChk1 = str;
                    }
                },
                setAudio : function(){
                    if(state.startSet==true){
                        $audio.append("<source src='"+state.url+"' type='audio/mpeg' />");
                        $audio[0].volume = state.volume;
                        state.startSet = false;
                    }
                },
                openPlay : function(){
                    if(state.playChk1){
                        this.eqAction(false);
                        state.playChk2 = false;
                    }else{
                        state.playChk2 = true;
                    }
                },
                closePlay : function(){
                    if(state.playChk1==false && state.playChk2==false) this.eqAction(true);
                }
            };

            return Person;
        })();

        var eq = new Equalizer({
            parent:"#equalizer",            // 이퀄라이저 애니메이션 부모 엘리먼트
            children:"span",                // 이퀄라이저 애니메이션 자식 엘리먼트
            btn:".btn_eq",                  // 버튼 클래스
            url:"../media/audio.mp3",       // 오디오 url
            volume:0.5,                     // 볼륨
            setStr:false                    // 이퀄라이저 동작여부(true : play / false : pause)  ※ 크롬에서는 크롬 정책으로 인해 자동 재생 불가
        });

        $(".btn_layer").on("click", function(){
            eq.openPlay();
        });

        $(".btn_close1").on("click", function(){
            eq.closePlay();
        });

        // var agent = navigator.userAgent.toLowerCase();
        // if (agent.indexOf("chrome") != -1) {
        //     if (self.name != "reload") {
        //         self.name = "reload";
        //         self.location.reload(true);
        //     }else{
        //         self.name = "";
        //     }
        // }
    </script>
</body>
</html>
