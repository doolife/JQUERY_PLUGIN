<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
<title>css equalizer &amp; audio</title>
<meta name="Keywords" content="">
<meta name="Description" content="">
<link rel="stylesheet" href="../css/base.css" />
<script src="../js/jquery-3.2.1.min.js"></script>
<!--[if lt ie 9]>
<script src="../js/html5.js"></script>
<script src="../js/respond.js"></script>
<![endif]-->
<style>
.btn_eq {margin:10px auto 0; width:100px; height:50px; display:block; position:relative; background:#ddd;}
.btn_eq:before {content:"stop"; width:100%; height:100%; line-height:50px; text-align:center; position:absolute; left:0; top:0;}
.btn_eq.play:before {content:"play";}
#equalizer {margin:0 auto 0; width:40px; height:30px; position:relative; overflow:hidden; cursor:pointer; }
#equalizer>span {width:3px; height:1px; display:inline-block; bottom:0; position:absolute; background-color:#000;
    animation-duration:500ms;
    animation-play-state:running;
    animation-direction:alternate;
    animation-timing-function:linear;
    animation-iteration-count:infinite;
}

#equalizer>.stop {
    animation:none;
    animation-name:none;
}

#equalizer>.bar1 {
    left:0;
    animation-name:danceHeight1;
    animation-delay:300ms;
}
#equalizer>.bar2 {
    left:6px;
    animation-name:danceHeight2;
    animation-delay:600ms;
}
#equalizer>.bar3 {
    left:12px;
    animation-name:danceHeight3;
    animation-delay:0ms;
}
#equalizer>.bar4 {
    left:18px;
    animation-name:danceHeight4;
    animation-delay:1500ms;
}
#equalizer>.bar5 {
    left:24px;
    animation-name:danceHeight5;
    animation-delay:1200ms;
}
#equalizer>.bar6 {
    left:30px;
    animation-name:danceHeight6;
    animation-delay:900ms;
}

@keyframes danceHeight1 {
    from {height:1px;}
    to {height:18px;}
}
@keyframes danceHeight2 {
    from {height:1px;}
    to {height:15px;}
}
@keyframes danceHeight3 {
    from {height:1px;}
    to {height:22px;}
}
@keyframes danceHeight4 {
    from {height:1px;}
    to {height:10px;}
}
@keyframes danceHeight5 {
    from {height:1px;}
    to {height:20px;}
}
@keyframes danceHeight6 {
    from {height:1px;}
    to {height:15px;}
}
</style>
</head>
<body>
    <div id="equalizer">
        <span class="bar1"></span>
        <span class="bar2"></span>
        <span class="bar3"></span>
        <span class="bar4"></span>
        <span class="bar5"></span>
        <span class="bar6"></span>
    </div>
    <button type="button" class="btn_eq"></button>
    <audio controls="controls" data-media="audio">
        <source src="../media/audio.mp3" type="audio/ogg" />
        <source src="../media/audio.mp3" type="audio/mpeg" />
    </audio>
    <script>
        var equalizer = (function (window, document, $, undefined) {

            var $pelement, $celement, $eventEl, startAni;    // 엘리먼트 및 옵션 전역변수

            var init = function(opts) {
                $pelement = $(opts.parent), $celement = $(opts.children), startAni = opts.start, $eventEl = $(opts.events);    // 엘리먼트 및 옵션 변수 전역변수로 넘김
                setEqualizer();    //  setEqualizer 함수 호출
                controls();    // controls 함수 호출
            };

            var controls = function(){
                if($eventEl.length!=0){    // 옵션에 click 엘리먼트를 넣었다면 click 엘리먼트 사용
                    $eventEl.on("click", function(e){
                        setEqualizer();    //  setEqualizer 함수 호출
                    });
                }else{    // 옵션에 click 엘리먼트를 넣지않았다면 parent 엘리먼트 사용
                    $pelement.on("click", function(e){
                        setEqualizer();    //  setEqualizer 함수 호출
                    });
                }
            };

            function setEqualizer(){    // class="stop" 추가 삭제 기능
                if(startAni!=true){    // startAni 변수가 true가 아니라면
                    $pelement.find($celement).addClass("stop");    // class="stop" 를 추가한다(애니메이션비활성)
                    $("[data-media='audio']")[0].pause();
                    $eventEl.addClass("play");
                    startAni = true;    // startAni 변수를 true로 변경
                }else{    // startAni 변수가 true가 맞다면
                    $("[data-media='audio']")[0].play();
                    $pelement.find($celement).removeClass("stop");    // class="stop" 를 삭제한다(애니메이션활성)
                    $eventEl.removeClass("play");
                    startAni = false;    // startAni 변수를 false로 변경
                }
                // startAni = (startAni==true)? false : true;
            }

            return {
                options:init    // init함수를 options이란 이름으로 외부에서 사용가능
            };

        })(window, document, $);

        new equalizer.options({
            parent:"#equalizer",    // 부모 엘리먼트
            children:"span",    // 자식 엘리먼트
            events:".btn_eq",    // click 엘리먼트(삭제시 기본 엘리먼트는 parent가 적용됨 )
            start:true    // 처음 시작할때 이퀄라이저 동작여부(true : play / false : stop)
        });
    </script>
</body>
</html>
