<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
<title> jquery sprite </title>
<meta name="Keywords" content="">
<meta name="Description" content="">
<link rel="stylesheet" href="../css/base.css" />
<script src="../js/jquery-3.1.1.min.js"></script>
<!--[if lt ie 9]>
<script src="../js/html5.js"></script>
<script src="../js/respond.js"></script>
<![endif]-->
<style>
#sprite1 {overflow:hidden;}
</style>
</head>
<body>
    <div id="sprite1">
        <div class="sprite"></div>
    </div>
    <script>
        (function($) {

            //    jquerySprite version 0.1
            var plugin_name = "jquerySprite";

            $.fn[plugin_name] = function(options) {

                var defaults = {    // 사용자 옵션이 없을때 기본값
                    idx:0,
                    urlStr:"PLUGIN",
                    imgPath:"/images/sprite/po.png",
                    page:10,
                    width:408,
                    height:406
                };
                var opts = $.extend({}, defaults, options || {});
                var $element = $(this);

                var url = decodeURIComponent(location.href);
                    url = decodeURIComponent(url);
                var strSrc = url.substring(0, url.indexOf(opts.urlStr)+opts.urlStr.length);    // substring(n, m) 문자열의 n번째부터 m번째까지 표시, indexOf("문자") 문자의 위치값을 왼쪽부터 계산하여 숫자로 표시
                var consTructors = {
                    init : function() {
                        $element.css({width:opts.width, height:opts.height});
                        $element.children(".sprite").css({width:opts.width*opts.page, height:opts.height, backgroundImage:"url("+strSrc+opts.imgPath+")"});
                        consTructors.action();
                        consTructors.play(opts.idx);
                    },
                    action : function(){
                        if (typeof opts.callBack == "function"){    // index 값 콜백
                            opts.callBack(0);
                        }
                    },
                    play : function(num){
                        timer = setTimeout( function(){
                            console.log(num)
                            num = num+1;
                            consTructors.play(num);
                            $element.children(".sprite").css({"background-position-x":opts.width*num});
                            if(num>=opts.page){
                                clearTimeout(timer);
                            }
                        }, 120);

                    }
                }

                consTructors.init();
            }

        })(jQuery);

        $("#sprite1").jquerySprite({
            idx:0,
            urlStr:"PLUGIN",
            imgPath:"/images/sprite/po.png",
            page:10,
            width:408,
            height:406,
            callBack:function(num){
                aaa = num;
            }
        });

    </script>
</body>
</html>
