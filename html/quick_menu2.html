<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
<title>퀵메뉴</title>
<meta name="Keywords" content="">
<meta name="Description" content="">
<link rel="stylesheet" href="../css/base.css" />
<script src="../js/jquery-3.2.1.min.js"></script>
<!--[if lt ie 9]>
<script src="../js/html5.js"></script>
<script src="../js/respond.js"></script>
<![endif]-->
<style>
html, body {min-width:1100px;}
header {height:700px; position:relative;}
header:before {content:"확인용구분선"; width:100%; height:1px; text-align:center; position:absolute; left:0; top:400px; background:#000;}
/* side_menu */
.quick_menu {margin-left:600px; width:100px; position:absolute; left:50%; top:400px; background:#ddd;}
.quick_menu>.menu_list>li {width:100%; height:100px;}
.quick_menu>.menu_list>li.active {background:brown;}
.quick_menu>.menu_list>li.active>a {color:#fff;}
.quick_menu>.menu_list>li>a {width:100%; height:100%; display:block;}
.quick_menu>.btn_top {width:100px; height:100px; display:block; background:#fff; position:absolute; bottom:-100px; left:0;}
.quick_menu.fixed {position:fixed;}
section {height:1000px; text-align:center;}
.section1 {background:#f57eff;}
.section2 {background:#29f969;}
.section3 {background:#fbd637;}
.section4 {background:#ff0000;}
.section5 {height:2500px; background:#0b8ebf;}
</style>
</head>
<body>
    <header>header</header>
    <!-- side_menu -->
    <aside class="quick_menu" data-quick="wrap" data-options='{"fix":100, "qspeed":300, "cspeed":600, "tspeed":800, "delay":10}'>
        <ul class="menu_list">
            <li data-list="link"><a href="http://www.naver.com" target="_blank">naver_link</a></li>
            <li data-list="list"><a href="#">2</a></li>
            <li data-list="link"><a href="http://www.daum.net" target="_blank">daum_link</a></li>
            <li data-list="list"><a href="#">4</a></li>
        </ul>
        <a href="#" class="btn_top" data-top="top">TOP</a>
    </aside>
    <section class="section1" data-contents="con">1</section>
    <section class="section2" data-contents="con">2</section>
    <section class="section3" data-contents="con">3</section>
    <section class="section4" data-contents="con">4</section>
    <section class="section5">5</section>
    <script>
        var quickMenu = (function (window, document, $, undefined) {

            var top, fixTop, qspeed, cspeed, tspeed, delay,
                timeout;// setTimeout 전역 변수

            var $wrap = $("[data-quick='wrap']"),
                $list      = $wrap.find("[data-list]"),
                $contents  = $("[data-contents='con']"),
                $btnTop    = $("[data-top='top']");

            var init = function() {
                fixTop = $("[data-options]").data("options").fix,    // 스크롤시 상단에서 떨어진 값
                qspeed = $("[data-options]").data("options").qspeed, // 스크롤시 퀵메뉴 이동하는 스피드
                cspeed = $("[data-options]").data("options").cspeed, // 퀵메뉴 클릭시 이동하는 스피드
                tspeed = $("[data-options]").data("options").tspeed, // TOP버튼 클릭시 퀵메뉴 이동하는 스피드
                delay  = $("[data-options]").data("options").delay;  // 스크롤 정지체크 시간
                controls();    // 스크롤 및 버튼 컨트롤러 함수 호출
                scrollAction();    // 스크롤 관련 함수 호출
            };

            var controls = function(){
                top = $wrap.offset().top;    // 퀵메뉴 상단에서 떨어진 값을 읽어와서 변수에 저장

                $(window).on("scroll", function(){
                    clearTimeout(timeout);    // setTimeout을 계속 해제하기때문에 밑에 구문이 실행안됨(스크롤 동작이 멈췄을때 먼저 실행후 밑의 구문을 실행)
                    timeout = setTimeout(function(){    // 스크롤 동작 멈췄을때 delay 시간이 지나면 시작
                        scrollAction();    // scrollAction 함수 호출
                    }, delay);    // 스크롤 동작 체크 시간
                });

                $list.on("click", function(e){
                    var target = $(this).index(); // $list.index(this)    // 내가 클릭한 index 값을 변수에 저장
                    listSlide(target, e);    // listSlide 함수 호출하면서 변수를 인자값으로 보냄
                });

                $btnTop.on("click", function(e){
                    e.preventDefault();
                    $("html, body").stop().animate({scrollTop:0}, tspeed);    // TOP버튼 클릭시 스크롤이 최상단으로 이동
                });
            };

            function scrollAction(){
                var scltop     = $(window).scrollTop(),    // 스크롤값을 변수에 저장
                    firstTop   = $contents.eq(0).offset().top,    // 첫번째 컨텐츠 위치값을 저장
                    lastBottom = $contents.eq($contents.length-1).offset().top + $contents.eq($contents.length-1).height();    // 마지막 컨텐츠 하단 위치값을 저장
                if(scltop >= top-fixTop){    // 스크롤 위치값이 퀵메뉴 위치값보다 같거나 클경우 실행
                    $wrap.stop().animate({top:$(window).scrollTop()+fixTop}, qspeed);    // 퀵메뉴가 스크롤을 따라다니는 애니메이션
                    // $wrap.addClass("fixed").css({top:fixTop});    css fixed 작업하고 클래스를 설정하여 더 쉽게 할 수 있으나 body에 min-width를 넣어야 할 경우 가로 스크롤을 이동하여도 퀵메뉴가 보이지않는 현상때문에 주석처리
                }else{    // 스크롤 위치값이 퀵메뉴 위치값보다 작을 경우 실행
                    $wrap.stop().animate({top:top}, qspeed);    // css로 정해놓은 퀵메뉴 상단값으로 이동
                    // $wrap.removeClass("fixed").css({top:""});
                }
                for( var i=0, len=$list.length ; i<len ; i++ ){    // 퀵메뉴 갯수만큼 for문 돌림
                    var conTop = $contents.eq(i).offset().top;    // 각각의 컨텐츠 위치값을 변수에 저장
                    if(conTop<=scltop){    // 스크롤 위치값이 각각의 컨텐츠 위치값보다 같거나 클경우
                        if($list.eq(i).data("list")=="link"){
                            $list.removeClass("active");
                        }else{
                            $list.removeClass("active");    // 퀵메뉴 li class를 모두 없앤다
                            $list.eq(i).addClass("active");    // 현재 보이는 컨텐츠에 맞는 퀵메뉴 li class를 추가한다(바로 위 구문에서 다 없애고 현재것만 추가하는 방식)
                        }
                    }
                    if(scltop<firstTop || scltop>lastBottom){    // 스크롤 위치값이 첫번째 컨텐츠 위치값보다 작거나 또는 마지막 컨텐츠의 하단 위치값보다 클경우(둘조건중 하나만 해당해도 실행)
                        $list.removeClass("active");    // 퀵메뉴 li class를 모두 없앤다
                    }
                }
            }

            function listSlide(thisNum, e){    // 인자값으로 index 와 event 받음
                if($list.eq(thisNum).data("list")!="link"){    // 각각의 li에 data-quick값이 link가 아닐 경우 실행(list일 경우 실행)
                    e.preventDefault();    // data-quick값이 link가 아닌경우 링크 막기
                    $("html, body").stop().animate({scrollTop:$contents.eq(thisNum).offset().top}, cspeed);    // 클릭한 퀵메뉴의 index와 같은 컨텐츠 위치로 이동(퀵메뉴 data-quick값이 list인 애들의 위치로만 이동)
                }
            }

            return {
                init:init()
            };

        })(window, document, $);

        // $(document).ready(function() {
        //     quickMenu.init();    // quickMenu.init 함수 호출
        // });
    </script>
</body>
</html>
