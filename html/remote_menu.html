<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width" />
    <title>remote menu</title>
    <meta name="Keywords" content="">
    <meta name="Description" content="">
    <link rel="stylesheet" href="../css/base.css" />
    <link rel="stylesheet" href="../css/remote.css" />
    <script src="../js/jquery-3.2.1.min.js"></script>
    <!--[if lt ie 9]>
    <script src="../js/html5.js"></script>
    <script src="../js/respond.js"></script>
    <![endif]-->
    <style>
    .remote_wrap {min-width:1100px; position:relative; overflow:hidden;}
    header {height:800px;}
    .section1_1 {height:700px; background:cornflowerblue;}
    .section1_2 {height:700px; background:greenyellow;}
    .section1_3 {height:700px; background:orangered;}
    .section2_1 {height:700px; background:forestgreen;}
    .section2_2 {height:700px; background:hotpink;}
    .section2_3 {height:700px; background:violet;}
    .section3 {height:700px;}
    </style>
</head>
<body>
    <div class="remote_wrap">
        <header></header>
        <aside id="remoteMenu" class="remote_menu">
            <div class="remote_overflow">
                <button type="button" class="remote_arrow" data-btn="arrow"></button>
                <ul class="menu_list" data-remote="wrap">
                    <li data-list="list">
                        <a href="#section1">신규/복귀  혜택</a>
                        <ul>
                            <li data-list="list"><a href="#section1_1">참여 방법</a></li>
                            <li data-list="list"><a href="#section1_2">도전 인챈트</a></li>
                            <li data-list="list"><a href="#section1_3">Bonus</a></li>
                        </ul>
                    </li>
                    <li data-list="list">
                        <a href="#section2">신규/복귀 이용권</a>
                        <ul>
                            <li data-list="list"><a href="#section2_1">이용권 구성</a></li>
                            <li data-list="list"><a href="#section2_2">이용권 상세안내</a></li>
                            <li data-list="list"><a href="#section2_3">탐나는 성장의 열매 효과</a></li>
                        </ul>
                    </li>
                    <li data-list="list">
                        <a href="#section3">업데이트 갤러리</a>
                    </li>
                </ul>
                <div class="remote_etc">
                        <span>
                            <a href="https://lineage.plaync.com" target="_blank" class="remote_link remote_home">공식 홈페이지</a>
                            <a href="http://nshop.plaync.com/nshop/" class="remote_link remote_nshop">리니지 N샵</a>
                        </span>
                </div>
            </div>
        </aside>
        <section data-id="section1" data-contents="con">
            <section data-id="section1_1" data-contents="scon" class="section1_1"></section>
            <section data-id="section1_2" data-contents="scon" class="section1_2"></section>
            <section data-id="section1_3" data-contents="scon" class="section1_3"></section>
        </section>
        <section data-id="section2" data-contents="con">
            <section data-id="section2_1" data-contents="scon" class="section2_1"></section>
            <section data-id="section2_2" data-contents="scon" class="section2_2"></section>
            <section data-id="section2_3" data-contents="scon" class="section2_3"></section>
        </section>
        <section data-id="section3" data-contents="con" class="section3">
            <section data-id="section3_1" data-contents="scon" class="section3_1"></section>
        </section>
    </div>
    <script>
        function Remote(opts) {
            this.opts = opts;

            this.$wrap = $(opts.element);
            this.$gnb = this.$wrap.find($("[data-remote='wrap']")).children("[data-list='list']");
            this.$snb = this.$gnb.find("[data-list='list']");
            this.$cnb = this.$wrap.find($("[data-remote='wrap']")).find("[data-list='list']");
            this.$cnbli = this.$wrap.find($("[data-remote='wrap']")).find("li");
            this.$con = $("[data-contents='con']");
            this.$scon = $("[data-contents='scon']");
            this.$btnArrow = $("[data-btn='arrow']");

            this.state = {
                isMobile: false,
                resizeWidth: false,
                gnbNum: false,
                snbNum: false,
                removeChk: false,
                scrollTop: $(window).scrollTop(),
                scrollTopSave: false,
                scChk: true
            };

            this.arrowSlide();
            this.controls();
        }

        Remote.prototype = {
            controls: function () {
                var context = this;
                if (this.opts.quick) {
                    this.$gnb.children("a").on("click", function () {
                        var hash = $(this).attr("href"),
                            reStr = hash.replace(/#/g, "");

                        context.mobileBodyFix();
                        context.listSlide(reStr);
                    });

                    this.$snb.children("a").on("click", function () {
                        var hash = $(this).attr("href"),
                            reStr = hash.replace(/#/g, "");

                        context.mobileBodyFix();
                        context.listSlide(reStr);
                    });
                } else {
                    if (!this.opts.type) {
                        this.$gnb.children("a").on("click", () => {
                            this.mobileBodyFix();
                        if (this.state.isMobile) {
                            this.arrowSlide();
                        }
                    });
                    } else {
                        this.$cnbli.children("a").on("click", () => {
                            this.mobileBodyFix();
                        if (this.state.isMobile) {
                            this.arrowSlide();
                        }
                    });
                    }
                }

                $(window).on("resize", () => {
                    this.state.isMobile = (!window.matchMedia("(min-width:769px)").matches);
                this.state.resizeWidth = this.$wrap.outerWidth();
                if (this.opts.show) {
                    this.opts.show = false;
                    this.arrowSlide();
                } else {
                    this.mobileMask();
                }
                this.scrollAction();
            }).resize();

                $(window).on("scroll", () => {
                    if (this.state.isMobile) {
                    if (!this.state.scChk) return false;
                }
                this.state.scrollTop = $(window).scrollTop();
                this.scrollAction();
            });

                this.$btnArrow.on("click", () => {
                    this.mobileBodyFix();
                this.arrowSlide();
            });

                $(document).on("click", "[data-remote='mask']", () => {
                    this.mobileBodyFix();
                this.arrowSlide();
            });
            },

            navAnchor: function (num) {
                if (!this.opts.type) {
                    this.$gnb.removeClass("active");
                    this.$gnb.eq(num).addClass("active");
                } else {
                    this.$cnb.parent("ul").parent("li").removeClass("active");
                    this.$cnb.removeClass("active");
                    this.$cnb.eq(num).parent("ul").parent("li").addClass("active");
                    this.$cnb.eq(num).addClass("active");
                }
            },

            scrollAction: function () {
                var scltop = $(window).scrollTop();
                if (!this.state.isMobile) {
                    if (scltop >= this.opts.top - this.opts.fix) {
                        this.$wrap.addClass("fix").css({top: this.opts.fix});
                    } else {
                        this.$wrap.removeClass("fix").css({top: this.opts.top});
                    }
                } else {
                    this.$wrap.removeClass("fix").css({top: ""});
                }

                this.quickAnchor(scltop)
            },

            quickAnchor: function (scltop) {
                if (this.opts.quick) {
                    var firstTop = this.$con.eq(0).offset().top,
                        // lastBottom = this.$con.eq(this.$con.length - 1).offset().top + this.$con.eq(this.$con.length - 1).height(),
                        endScroll = $(window).scrollTop() === $(document).height() - $(window).height();
                    for (var i = 0, len = this.$con.length; i < len; i++) {
                        var conTop = this.$con.eq(i).offset().top;
                        if (conTop <= scltop) {
                            this.state.gnbNum = i;
                            for (var j = 0, slen = this.$con.eq(i).children(this.$scon).length; j < slen; j++) {
                                var sconTop = this.$con.eq(i).children(this.$scon).eq(j).offset().top;
                                if (sconTop <= scltop) {
                                    this.state.snbNum = j;
                                }
                            }
                        }
                        // removeChk = (scltop < firstTop || scltop > lastBottom) ? true : false;
                        this.state.removeChk = (scltop < firstTop);
                    }

                    if (!this.state.removeChk) {
                        this.$gnb.removeClass("active");
                        this.$gnb.find(this.$snb).removeClass("active");
                        if (endScroll) {
                            this.$gnb.eq(this.$gnb.length - 1).addClass("active");
                            this.$gnb.eq(this.$gnb.length - 1).find(this.$snb).eq(this.$gnb.eq(this.$gnb.length - 1).find(this.$snb).length - 1).addClass("active");
                        } else {
                            this.$gnb.eq(this.state.gnbNum).addClass("active");
                            this.$gnb.eq(this.state.gnbNum).find(this.$snb).eq(this.state.snbNum).addClass("active");
                        }
                    } else {
                        this.$gnb.removeClass("active");
                        this.$gnb.find(this.$snb).removeClass("active");
                    }
                }

                this.remoteShowHide();
            },

            remoteShowHide: function () {
                if (!this.state.removeChk) {
                    this.$wrap.css({display: "block"});
                } else {
                    if (this.state.isMobile) {
                        this.opts.show = false;
                    } else {
                        this.opts.show = (!this.opts.show);
                    }
                    this.arrowSlide();
                    this.$wrap.css({display: "none"});
                }
            },

            arrowSlide: function () {
                if (this.opts.show) {
                    this.$wrap.stop().animate({right: 0}, 250).find(this.$btnArrow).addClass("on");
                    this.state.scChk = false;
                    this.opts.show = false;
                } else {
                    this.$wrap.stop().animate({right: -this.state.resizeWidth}, 250).find(this.$btnArrow).removeClass("on");
                    this.state.scChk = true;
                    this.opts.show = true;
                }
                this.mobileMask();
            },

            mobileBodyFix: function () {
                if (this.opts.show) {
                    this.state.scrollTopSave = this.state.scrollTop;
                    if (this.state.isMobile) {
                        $("body").css({height: "auto", position: "fixed", overflow: "hidden", marginTop: -this.state.scrollTop});
                    }
                } else {
                    if (this.state.isMobile) {
                        $("body").css({height: "", position: "", overflow: "", marginTop: ""});
                        $("html, body").scrollTop(this.state.scrollTopSave);
                    }
                }
            },

            mobileMask: function () {
                $("#mobileMask").remove();
                if (this.state.isMobile) {
                    if (!this.opts.show) {
                        this.$wrap.before($("<div id='mobileMask' data-remote='mask'></div>"));
                        $("html").css({height: "auto", overflow: "hidden"});
                    } else {
                        $("html").css({height: "", overflow: ""});
                    }
                } else {
                    $("html").css({height: "", overflow: ""});
                    $("body").css({height: "", position: "", overflow: "", marginTop: ""});
                }
            },

            listSlide(id) {
                var conOffset = $("[data-id='" + id + "']").offset().top;
                $("html, body").stop().animate({scrollTop: conOffset}, this.opts.cspeed);
                if (this.state.isMobile) {
                    this.arrowSlide();
                }
            },
        };

        $(document).ready(function(){
            new Remote({
                element:"#remoteMenu",  // element
                top:920,    // 기본 상단에서 떨어진 값
                fix:100,    // 스크롤시 상단에서 떨어진 값
                cspeed:600,    // 퀵메뉴 클릭시 이동하는 스피드
                show:false,    // true : 보이기 / false : 숨기기
                quick:true      // true : 퀵메뉴 / flase : 네비게이션
            });
        });
    </script>
</body>
</html>
